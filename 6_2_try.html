<!DOCTYPE html>
<html lang="ru">
  <head>
		<title>basket</title>
		<meta charset="utf-8" >
		<link href="styles_.css" rel="stylesheet">
  </head>
  <body>
		<div class="item_box">
		<h3 class="item_title">Пылесос Tefal TY8875RO</h3>
		<p>Цена: <span class="item_price">9327</span>₽</p>
		<button class="add_item" data-id="7">Купить</button>
		</div>
		<div class="item_box">
		<h3 class="item_title">Мультиварка Moulinex CE502832</h3>
		<p>Цена: <span class="item_price">4850</span>₽</p>
		<button class="add_item" data-id="2">Купить</button>
		</div>
		<div class="item_box">
		<h3 class="item_title">Электрофен Rowenta CV4750F0</h3>
		<p>Цена: <span class="item_price">1199</span>₽</p>
		<button class="add_item" data-id="5">Купить</button>
		</div>
		</div>
		<div class="item_box">
		<h3 class="item_title">Кофемашина Krups EA810B70</h3>
		<p>Цена: <span class="item_price">18298</span>₽</p>
		<button class="add_item" data-id="9">Купить</button> <br>
		</div>
		<button id="checkout">Оформить заказ</button>
		<button id="clear_cart">Очистить корзину</button>
		<div id="cart_content"></div>
	<script>
var d = document,
    itemBox = d.querySelectorAll('.item_box'), 
    cartCont = d.getElementById('cart_content'); 
		function addEvent(elem, type, handler){
				if(elem.addEventListener){
					elem.addEventListener(type, handler, false);
		} 
		else {
				elem.attachEvent('on'+type, function(){ handler.call( elem ); });
		}
		return false;
		}
	function getCartData(){
		return JSON.parse(localStorage.getItem('cart'));
		}
	function setCartData(o){
		localStorage.setItem('cart', JSON.stringify(o));
		return false;
		}
	function addToCart(e){
		this.disabled = true; 
			var cartData = getCartData() || {}, 
			parentBox = this.parentNode, 
			itemId = this.getAttribute('data-id'), 
			itemTitle = parentBox.querySelector('.item_title').innerHTML, 
			itemPrice = parentBox.querySelector('.item_price').innerHTML; // стоимость товара
	if(cartData.hasOwnProperty(itemId)){ 
		cartData[itemId][2] += 1;
	} else { 
    cartData[itemId] = [itemTitle, itemPrice, 1];
	}
		if(!setCartData(cartData)){ 
			this.disabled = false; 
			}
			return false;
			}
for(var i = 0; i < itemBox.length; i++){
  addEvent(itemBox[i].querySelector('.add_item'), 'click', addToCart);
}
function openCart(e){
        var cartData = getCartData(),
                        totalItems = '',
                        totalCount = 0,
                        totalSum = 0;
        if(cartData !== null){
                totalItems = '<table class="shopping_list"><tr><th>Наименование</th><th>Цена</th><th>Кол-во</th><th></th></tr>';
                for(var items in cartData){
                        totalItems += '<tr>';
                        for(var i = 0; i < cartData[items].length; i++){
                        
                        if ( i == 1 ) {
                                totalItems += '<td align="right">' + cartData[items][i] + '</td>';
                                } else {
                                totalItems += '<td>' + cartData[items][i] + '</td>';
                                };
                        }
                        totalSum += cartData[items][1] * cartData[items][2];
                        totalCount += cartData[items][2];
                        totalItems += '<td><span class="del_item" data-id="'+ items +'"></span></td>';
                        totalItems += '</tr>';
                }
                totalItems += '<tr><td><strong>Итого</strong></td><td align="right">₽ <span id="total_sum">'+ totalSum +'</span></td><td><span id="total_count">'+ totalCount +'</span> шт.</td><td></td></tr>';
                totalItems += '</table>';
                cartCont.innerHTML = totalItems;
        } else {
                cartCont.innerHTML = 'В корзине пусто!';
        }
        return false;
}
addEvent(d.getElementById('checkout'), 'click', openCart);
addEvent(d.getElementById('clear_cart'), 'click', function(e){
  localStorage.removeItem('cart');
  cartCont.innerHTML = 'Корзина очишена.';
});
</script>
  </body>
</html>